(self.webpackChunk=self.webpackChunk||[]).push([[4382],{8482:(e,t,i)=>{i.d(t,{$:()=>a,EA:()=>o,QK:()=>r,SV:()=>s,Td:()=>l,x:()=>g});var n,s,o,a,r,l,c,u=i(73975),d=i(22232),h=i(16105);!function(e){e.isNoop=function(e){return 0===e.startOffset&&0===e.endOffset}}(n||(n={})),function(e){function t(e){return{start:Math.min(e.start,e.end),end:Math.max(e.start,e.end)}}e.eq=u.MW({start:u.lr,end:u.lr}),e.normalize=t,e.mergeAdjacent=function(e){return t=>{if(0===t.length)return[];const i=[t[0]];for(let n=1;n<t.length;++n){const s=i[i.length-1];e(s,t[n])?i[i.length-1]={start:s.start,end:t[n].end}:i.push(t[n])}return i}},e.create=function(e,i){return t({start:e,end:null!=i?i:e})},e.translate=function(e,t){return 0===t?e:{start:e.start+t,end:e.end+t}},e.transform=function(e,t){return n.isNoop(t)?e:{start:e.start+t.startOffset,end:e.end+t.endOffset}},e.rebase=function(e,t){return t.reduce(((e,t)=>{const i=h.q.getTransformOffset(t);return{start:t.pos<=e.start?Math.max(t.pos,e.start+i):e.start,end:t.pos<e.end?Math.max(t.pos,e.end+i):e.end}}),e)},e.contains=function(e,t,i){const n=i?t.start<=e.end:t.start<e.end;return t.start>=e.start&&n&&t.end>=e.start&&t.end<=e.end},e.isAdjacent=function(e,t){return e.end===t.start||t.end===e.start},e.intersects=function(e,t){return e.start>=t.start&&e.start<t.end||t.start>=e.start&&t.start<e.end},e.equals=function(t,i){return e.eq.equals(t,i)},e.toString=function(e){return`[${e.start}, ${e.end}]`},e.isCollapsed=function(e){return e.start===e.end},e.convertFromRawTransform=function(e){return{start:e.s,end:e.e}},e.length=function(e){return e.end-e.start}}(s||(s={})),function(e){e.hasTransformJSON=function(e){return"transformJSON"in e}}(o||(o={})),function(e){function t(e,t,i){return e.slice(t.start,t.end)===i}function i(e){return"transformJSON"in e&&Boolean(e.transformJSON)}function n(e){return"subalerts"in e&&e.subalerts&&"labels"in e&&Boolean(e.labels)}function s(e){return!i(e)&&!n(e)}function o({withPosition:e,withTransformJSON:t,withSubAlerts:o}){return a=>s(a)?e(a):i(a)?t(a):n(a)?o(a):void(0,d.vE)(a)}e.isConsistentWithText=function(i,n){let s;if(e.isWithSubAlerts(i))s=i.highlightRanges.every(((e,s)=>t(n,e,i.highlightTexts[s])));else{const e=i.highlightRanges.find((e=>"enclosing"===e.type))||i.highlightRanges[0];s=t(n,e,i.highlightTexts[0])}return s&&(!e.isRegular(i)||t(n,i.transformRange,i.transformText))},e.isWithTransformJson=i,e.isWithSubAlerts=n,e.isWithPosition=s,e.isRegular=function(e){return s(e)||i(e)},e.match=o,e.map=function({withPosition:e,withTransformJSON:t,withSubAlerts:i}){return o({withPosition:e,withTransformJSON:t,withSubAlerts:i})}}(a||(a={})),function(e){e.waitingForConnection="waitingForConnection",e.waitingForReconnection="waitingForReconnection",e.startingConnection="startingConnection",e.newSessionStarted="newSessionStarted",e.existingSessionStarted="existingSessionStarted"}(r||(r={})),function(e){e.ready="ready",e.inProgress="inProgress",e.reconnectRequired="reconnectRequired"}(l||(l={})),function(e){e.unknown="unknown",e.clientQueueNonEmpty="clientQueueNonEmpty",e.noSuchSession="noSuchSession",e.cannotReconnectToSelf="cannotReconnectToSelf",e.differentUsers="differentUsers",e.sessionClosed="sessionClosed",e.messageCountIncorrect="messageCountIncorrect"}(c||(c={}));const g=(e,t)=>{if(!e)return c.clientQueueNonEmpty;if(!t)return c.unknown;const{reconnectFailedReason:i}=t;if("no such session"===i)return c.noSuchSession;if("cannot reconnect to self"===i)return c.cannotReconnectToSelf;if("different users"===i)return c.differentUsers;if("session is closed"===i)return c.sessionClosed;return i&&/(client send|server send|no such message in buffer)/.test(i)?c.messageCountIncorrect:c.unknown}},95572:(e,t,i)=>{i.d(t,{DD:()=>v,Hq:()=>y,J8:()=>b,TC:()=>o,kQ:()=>w,uM:()=>s,wF:()=>_});var n,s,o,a=i(40327),r=i(90361),l=i(8482),c=i(5114),u=i(63513),d=i(73353),h=i(80800),g=i(49524),p=i(22232),m=i(89943);!function(e){e.synonym="Synonym",e.plagiarism="Plagiarism",e.grammar="Grammar",e.contextualSpelling="ContextualSpelling",e.sentenceStructure="SentenceStructure",e.punctuation="Punctuation",e.style="Style",e.enhancement="Enhancement",e.spelling="Spelling",e.voxStyle="VoxStyle",e.snippets="Snippets",e.other="Other"}(n||(n={})),function(e){e.sales_crm="sales_crm",e.sales_engagement="sales_engagement",e.sales_enablement="sales_enablement",e.marketing_email_automation="marketing_email_automation",e.marketing_content="marketing_content",e.customer_service="customer_service",e.customer_surveys_surveys="customer_surveys_surveys",e.recruiting="recruiting",e.training_learning="training_learning",e.project_management="project_management",e.legal="legal",e.contractors="contractors",e.human_resources="human_resources",e.email="email",e.business_chat="business_chat"}(s||(s={})),function(e){e.correctness="correctness",e.clarity="clarity",e.engagement="engagement",e.tone="tone",e.vox="vox",e.knowledgeHub="knowledgeHub",e.other="other"}(o||(o={}));const f=[o.clarity,o.correctness,o.engagement,o.tone],_=e=>f.includes(e);var v,b,S,y,w;!function(e){function t({withPosition:t,withTransformJSON:i,withSubAlerts:n}){return s=>e.isWithPosition(s)?t(s):e.isWithTransformJson(s)?i(s):e.isWithSubAlerts(s)?n(s):void(0,p.vE)(s)}e.isWithTransformJson=e=>l.$.isWithTransformJson(e),e.isWithSubAlerts=e=>l.$.isWithSubAlerts(e),e.isWithPosition=e=>l.$.isWithPosition(e),e.isRegular=e=>l.$.isRegular(e),e.match=t;const i={Correctness:o.correctness,Clarity:o.clarity,Engagement:o.engagement,Tone:o.tone,"Style guide":o.vox,"Knowledge Hub":o.knowledgeHub};e.createOutcomeType=function(e){return e&&i[e]||o.other},e.ordering={greaterThanOrEqual:(e,t)=>e.isEthicalAIStandWithUkraine||t.isEthicalAIStandWithUkraine?e.isEthicalAIStandWithUkraine:e.isShortenIt&&t.isShortenIt?e.priority>=t.priority:!(e.isShortenIt&&!t.isShortenIt)&&(!(e.isShortenIt||!t.isShortenIt)||(e.isSuggestedSnippet||t.isSuggestedSnippet?e.priority>=t.priority:!e.isFree&&t.isFree||e.isFree&&!t.isFree?e.isVox||t.isVox?e.isVox:e.isFree:e.group===n.spelling&&t.group===n.spelling||e.group===n.contextualSpelling&&t.group===n.contextualSpelling||e.isVox&&t.isVox?e.priority>=t.priority:e.group===n.spelling||t.group!==n.spelling&&e.priority<=t.priority)),areConflicting:(t,i)=>(!t.isFree&&!i.isFree||t.isFree&&i.isFree||t.isVox||i.isVox)&&(!t.isTakeaway&&!i.isTakeaway||t.isTakeaway&&i.isTakeaway)&&!e.isMuted(t)&&!e.isMuted(i)&&(e.isRegular(t)&&e.isRegular(i)&&l.SV.equals(t.transformRange,i.transformRange)||m.Hx(t.highlightRanges,i.highlightRanges,l.SV.equals)),areSame:(e,i)=>{const n=e=>{const i=e=>({highlights:e.highlights,alternatives:(0,a.pipe)(e.alternatives,c.map((e=>({alternatives:e.alternatives}))))}),n=(0,a.pipe)(e,t({withPosition:e=>({highlightTexts:e.highlightTexts,highlightRanges:e.highlightRanges,transformText:e.transformText,transformRange:e.transformRange,replacements:e.replacements}),withTransformJSON:e=>i(e.transformJSON),withSubAlerts:e=>i(e.subalerts)}));return Object.assign(n,{priority:e.priority,isFree:e.isFree,group:e.group,outcome:e.outcome,category:e.category}),n};return(0,r.fS)(n(e),n(i))}},e.isInline=e=>e.inline===u.wQ.Inline.inline,e.isMuted=e=>void 0!==e.muted&&e.muted!==u.JW.MutedByType.NOT_MUTED,e.isFreePremiumLocked=e=>"locked_transform"===e.freePremium,e.isFreePremiumUnlocked=e=>"unlocked"===e.freePremium,e.isHidden=e=>e.isHidden}(v||(v={})),function(e){let t;!function(e){e.start="start",e.add="add",e.changed="changed",e.remove="remove",e.finished="finished",e.emogenie="emogenie",e.autocomplete="autocomplete",e.attentionHeatmap="attention_heatmap",e.attentionInfo="attention_info",e.shortenItFinished="shorten_it_finished",e.textInfo="text_info",e.submitOtAck="submit_ot_ack",e.proofitAvailability="realtime_proofit_availability",e.proofitCancelResponse="realtime_proofit_cancel_resp",e.proofitCompleted="realtime_proofit_completed",e.proofitProgress="realtime_proofit_in_progress",e.proofitProgressError="realtime_proofit_progress_error",e.proofitProgressRejected="realtime_proofit_progress_rejected",e.proofitSubmitResponse="realtime_proofit_submit_resp",e.feedback="feedback",e.error="error",e.publishedAck="published_ack",e.submitSurveyResultAck="submit_survey_result_ack",e.showSurvey="show_survey",e.sduiAdd="sdui_add",e.sduiUpdate="sdui_update",e.sduiRemove="sdui_remove",e.cheetahSetContext="cheetah:setContext",e.cheetahChunk="cheetah:chunk",e.cheetahResult="cheetah:result",e.cheetahError="cheetah:error",e.cheetahAck="cheetah:ack"}(t=e.Type||(e.Type={})),e.start=function(e){return{_tag:t.start,isEnterprise:e.isEnterprise,domainName:e.domainName,domainCategory:e.domainCategory,userMutedCategories:e.userMutedCategories,defaultDocumentContext:d.R$.serializeDefault((0,a.pipe)(e.defaultDocumentContext,c.fold((()=>d.R$.defaultContextFallback),g.y))),sessionUuid:e.sessionUuid,isNewSession:e.isNewSession,allowedFeatures:e.allowedFeatures,cheetahUsage:e.cheetahUsage}},e.add=function(e){return{_tag:t.add,alert:e}},e.change=function(e){return{_tag:t.changed,changed:e}},e.remove=function(e){return{_tag:t.remove,removedId:e}},e.finished=function(e){return{_tag:t.finished,finished:e}},e.emogenie=function(e){return{_tag:t.emogenie,emogenieReport:{emotions:e.emotions,hidden:e.hidden,institutionLogo:e.institutionLogo,brandTonesEnabled:e.brandTonesEnabled,brandTonesConfigured:e.brandTonesConfigured}}},e.textInfo=function(e){return{_tag:t.textInfo,...e}},e.submitOtAck=function(e){return{_tag:t.submitOtAck,data:e}},e.feedbackAck=function({scores:e,scoreStatus:i}){return{_tag:t.feedback,scores:e?h.v0.OutcomeScores.normalize(e):void 0,scoreStatus:i}},e.autocomplete=function(e,i,n){return{_tag:t.autocomplete,data:e,revision:i,connId:n}},e.attentionHeatmap=function(e,i){return{_tag:t.attentionHeatmap,heatmap:e,connectionId:i}},e.attentionInfo=function(e){return{_tag:t.attentionInfo,info:e}},e.shortenItFinished=function(e){return{_tag:t.shortenItFinished,alertId:e}},e.proofitAvailability=function(e){return{_tag:t.proofitAvailability,info:e}},e.proofitSubmitResponse=function(e){return{_tag:t.proofitSubmitResponse,info:e}},e.proofitProgress=function(e){return{_tag:t.proofitProgress,info:e}},e.proofitCompleted=function(e){return{_tag:t.proofitCompleted,info:e}},e.proofitProgressError=function(e){return{_tag:t.proofitProgressError,info:e}},e.proofitProgressRejected=function(e){return{_tag:t.proofitProgressRejected,info:e}},e.proofitCancelResponse=function(e){return{_tag:t.proofitCancelResponse,info:e}},e.error=function(e){return{_tag:t.error,error:"not_authorized"===e.error?"not_authorized":"unknown",raw_error:e.error,event:e}},e.publishedAck=function(e){return{_tag:t.publishedAck,survey:e.survey}},e.submitSurveyResultAck=function(){return{_tag:t.submitSurveyResultAck}},e.showSurvey=function(e){return{_tag:t.showSurvey,survey:e.survey}},e.sduiAdd=function(e){return{_tag:t.sduiAdd,event:e}},e.sduiUpdate=function(e){return{_tag:t.sduiUpdate,event:e}},e.sduiRemove=function(e){return{_tag:t.sduiRemove,event:e}},e.cheetahSetContext=function(e){return{_tag:t.cheetahSetContext,event:e}},e.cheetahChunk=function(e){return{_tag:t.cheetahChunk,event:e}},e.cheetahResult=function(e){return{_tag:t.cheetahResult,event:e}},e.cheetahError=function(e){return{_tag:t.cheetahError,event:e}},e.cheetahAck=function(e){return{_tag:t.cheetahAck,event:e}},e.isCheetahMessage=function(e){switch(e._tag){case t.cheetahSetContext:case t.cheetahChunk:case t.cheetahResult:case t.cheetahError:case t.cheetahAck:return!0;default:return!1}},e.isSDUIMessage=function(e){switch(e._tag){case t.sduiAdd:case t.sduiRemove:case t.sduiUpdate:return!0;default:return!1}}}(b||(b={})),function(e){e.british="british",e.american="american",e.australian="australian",e.canadian="canadian"}(S||(S={})),function(e){e.idle="idle",e.inProgress="inProgress"}(y||(y={})),function(e){e.notReady="notReady",e.ready="ready",e.firstTextCheckCompleted="firstTextCheckCompleted",e.disconnected="disconnected"}(w||(w={}))},74486:(e,t,i)=>{i.r(t),i.d(t,{CheetahFeatureImpl:()=>We});var n=i(17771),s=i(17889),o=i(75668),a=i(85892),r=i(57050),l=i(27378),c=i(8482),u=i(74850),d=i(5817),h=i(14601),g=i(32952),p=i(24209),m=i(85985),f=i(23063),_=i(66310),v=i(50628),b=i(40151),S=i(98403),y=i(2844),w=i(77176),R=i(2834),I=i(76974),C=i(28043),x=i(93508),E=i(16118),k=i(13444),A=i(78674),P=i(60797),U=i(17343),T=i(80544),O=i(79692),M=i(67434),B=i(19751),F=i(44586),N=i(97425),G=i(5114),q=i(8125),z=i(83078),H=i(22232),W=i(62965),D=i(95574),V=i(12187),L=i(38983),j=i(34217),Q=i(58541),$=i.n(Q);const J=({width:e,height:t,top:i,left:n})=>l.createElement("div",{"data-grammarly-part":"cheetah-highlight-rect",className:$().highlightRect,style:{width:e,height:t,top:i,left:n}});var Z=i(53386),K=i(74229);const Y=l.forwardRef((function({forceTooltipMessage:e,onClick:t,onMouseEnter:i,onMouseLeave:n},s){return l.createElement(Z.u,{message:"Open GrammarlyGO",forcedMessage:e},l.createElement("button",{onClick:t,"data-grammarly-part":"cheetah-ideate-button",className:K.ideateButton,ref:s,onMouseEnter:i,onMouseLeave:n},l.createElement("div",{className:K.ideateButtonIcon})))}));var X=i(79584),ee=i(86620),te=i(92132),ie=i(49468),ne=i(89894),se=i(33678),oe=i(15073),ae=i(42103),re=i(51369);const le=ne.ux.style({fontStyle:"normal",fontWeight:"normal",fontFamily:"Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif, Arial",$nest:{"button, input, textarea":{fontFamily:"inherit"}}}),ce=({env:e,children:t})=>l.createElement(ie.o,null,l.createElement(se.a.Context.Provider,{value:new ee.C(e)},l.createElement(te.Q,{remSize:I.of(16),setter:e=>oe.u.setRootCssVar(document.documentElement,e)},l.createElement(ae.G.DefaultProvider,null,l.createElement("div",{className:le},t,l.createElement(re.X,null))))));var ue=i(74204),de=i(62810);const he=({referenceElement:e,placement:t,offset:i,disabled:n,onClick:s})=>{const[o,a]=l.useState(null),{styles:r,attributes:c}=(0,ue.D)(e,o,{placement:t,modifiers:i?[{name:"offset",options:{offset:i}}]:[]});return l.createElement("button",{ref:a,style:r.popper,...c.popper,onClick:s,onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},"data-grammarly-part":"cheetah-reply-button",className:de.replyButton,"data-disabled":n},l.createElement("div",{className:de.icon}),l.createElement("span",null,"Reply quickly"))};var ge=i(73734);const pe=({referenceElement:e,placement:t,offset:i,disabled:n,onMagicRewriteClick:s,onOpenRewriteClick:o})=>{const[a,r]=l.useState(null),{styles:c,attributes:u}=(0,ue.D)(e,a,{placement:t,modifiers:i?[{name:"offset",options:{offset:i}}]:[]});return s||o?l.createElement("div",{ref:r,style:c.popper,...u.popper,onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},"data-grammarly-part":"cheetah-entry-button",className:ge.entryButton,"data-disabled":n},s?l.createElement(Z.u,{message:"Improve it"},l.createElement("button",{onClick:s,onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},className:ge.entryButtonItem,"data-disabled":n},l.createElement("i",{className:ge.rewriteIcon}))):null,o?l.createElement(Z.u,{message:"Open GrammarlyGO"},l.createElement("button",{onClick:o,onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},className:ge.entryButtonItem,"data-disabled":n},l.createElement("i",{className:ge.openIcon}))):null):null};var me=i(90845),fe=i(49708),_e=i(19703),ve=i(60688);const be=()=>l.createElement("svg",{className:ve.icon,viewBox:"0 0 16 16",fillRule:"evenodd",clipRule:"evenodd",strokeLinecap:"round"},l.createElement("path",{d:"M8,16C12.418,16 16,12.418 16,8C16,3.582 12.418,0 8,0C3.582,0 0,3.582 0,8C0,12.418 3.582,16 8,16Z",fill:"#0A9A78"}),l.createElement("path",{d:"M4,8L12,8M8,4L8,12",fill:"none",fillRule:"nonzero",stroke:"white",strokeWidth:"1.5px"})),Se=({overflow:e,...t})=>e?l.createElement(we,{...t}):l.createElement(ye,{...t}),ye=({left:e,top:t,height:i})=>l.createElement(l.Fragment,null,l.createElement("div",{"data-grammarly-part":"cheetah-quasi-caret",className:ve.quasiCaret,style:{left:e,top:t+i,height:i+8}},l.createElement(be,null))),we=({left:e,top:t,height:i})=>{const{ref:s,onMount:o}=me.P.useElWatcher(),a=l.useMemo((()=>L.h.create(G.none)),[]),{rect:c,onMount:u}=me.P.useRectWatcher(),d=l.useCallback((e=>{e.style.pointerEvents="all",a.set((0,r.zG)(n.Y(G.option)({rect:G.some(e.getBoundingClientRect()),goodParent:(0,r.zG)(e.getBoundingClientRect(),(e=>({x:e.x+e.width/2,y:e.y+e.height/2})),(({x:e,y:t})=>{var i,n;return G.fromNullable(null===(n=null===(i=document.elementFromPoint(e,t))||void 0===i?void 0:i.shadowRoot)||void 0===n?void 0:n.elementFromPoint(e,t))}),G.filter((t=>t===e||e.contains(t||null))))}),G.fold((()=>G.none),(({rect:e})=>G.some({x:e.x,y:e.y}))))),e.style.pointerEvents="none"}),[]),h=l.useMemo((()=>fe.R(document,"scroll",{capture:!0}).pipe(x.O(null))),[]);return me.P.useSubscriptionTo(y.aj([s.pipe(P.oA),h,c]).pipe(R.b((([e])=>d(e))))),l.createElement(l.Fragment,null,l.createElement("div",{"data-grammarly-part":"cheetah-quasi-caret",className:ve.quasiCaret,style:{left:e,top:t+i,height:i+8},ref:e=>{o(e),u(e)}},l.createElement(_e.F.div,{style:a.pipe(w.U((e=>(0,r.zG)(e,G.fold((()=>({opacity:1})),(()=>({opacity:0})))))))},l.createElement(be,null))),l.createElement(_e.F.Fragment,null,a.pipe(w.U((e=>(0,r.zG)(e,G.fold(r.gn,(e=>l.createElement("div",{"data-grammarly-part":"cheetah-quasi-caret-fixed-bro",className:ve.quasiCaret,style:{transform:"none",position:"fixed",left:e.x,top:e.y,height:i+8}},l.createElement(be,null))))))))))};var Re=i(95572),Ie=i(64015),Ce=i(55073),xe=i(22337),Ee=i(77993),ke=i(27605),Ae=i(4120),Pe=i(39464),Ue=i(8961),Te=i(62111),Oe=i(95195);function Me(e){return(0,r.zG)(decodeURIComponent(e),(t=>{try{const e=JSON.parse(t);return ke.Zq.codec.decode(e)}catch(t){return Oe.t$(`Cannot parse raw Cheetah onboarding state: ${e}.`)}}),Oe.fS((()=>ke.Zq.State.empty)))}function Be(e){return encodeURIComponent(JSON.stringify(ke.Zq.codec.encode(e)))}var Fe=i(23423),Ne=i(42040),Ge=i(30732);const qe=(0,V.xb)(Y),ze=new Set(["onboarding","gdocsOnboardingPopup","loginSSO","accountMigration","standWithUkraineGrammarlySuspended","claimedUser","dataControl","noPaymentMethodSubscription","grammarlyBusinessSigninPopup","gdocsFeedbackUI"]),He=new Set(["onboarding","gdocsOnboardingPopup","loginSSO","accountMigration","standWithUkraineGrammarlySuspended","claimedUser","dataControl","grammarlyBusinessSigninPopup"]);class We{constructor(e,t,i,n,s,a,l,c,d,C,x,E,k,A,P,U,z){this._integration=e,this._textChangeBuffer=t,this._checkingService=i,this._textStats=n,this._csPageState=s,this._cheetahCSActions=a,this._dapiActions=l,this._dapiSettings=c,this._closeGrammarlyAssistant=d,this._getEnv=C,this._featureFlags=x,this._user=E,this._gButtonPopupState=k,this._gButtonDisabledReason=A,this._sessionStartedUsageInfo=P,this._domain=U,this._gnar=z,this._subs=new h.w,this._log=u.Y.create("CheetahFeatureImpl"),this._inlineButtonUI=L.h.create(null),this._ideateButtonUI=L.h.create(null),this._expandedIdeateButtonUI=L.h.create(null),this._assistantUI=L.h.create(null),this._highlightUI=L.h.create(null),this._quasiCaretUI=L.h.create(null),this._onboardingUI=L.h.create(null),this._nativeCursorHider=L.h.create(G.none),this._lastRestartAttemptTime=L.h.create(0),this.inlineButtonUI=this._inlineButtonUI.view(),this.ideateButtonUI=this._ideateButtonUI.view(),this.expandedIdeateButtonUI=this._expandedIdeateButtonUI.view(),this.assistantUI=this._assistantUI.view(),this.highlightUI=this._highlightUI.view(),this.quasiCaretUI=this._quasiCaretUI.view(),this.onboardingUI=this._onboardingUI.view(),this._ideateButtonTooltipNotificationState=L.h.create(G.none),this._relevantCAPIEvents=new g.xQ,this._assistantFocused=L.h.create(!1),this._inlineButtonRecentlyPressed=L.h.create(!1),this._ideateButtonRecentlyHovered=L.h.create(!1),this._selectionRange=L.h.create(G.none),this._highlightRects=L.h.create([]),this._quasiCaretRect=L.h.create(G.none),this._assistantSession=L.h.create(G.none),this._onboardingViewModel=L.h.create(G.none),this._ideateButtonRefChange=new g.xQ,this._disposed=new g.xQ,this._initialOnboardingBlockedForSession=L.h.create(!1),this._cheetahServices=function(e,t,i,n,s,a,l,c,u,d,p,v,b,S,C,x,E,k,A){const P=new g.xQ,U=new xe.c3((()=>(0,r.zG)(e.get(),G.map((e=>({sendUserAction:(t,i)=>W.fj((()=>D.vM((()=>e.sendUserAction(t,i)))))}))),G.toNullable))),q={user:i.view((e=>({isFree:Ae.n5.isFree(e)})))},z=new xe.$C(I.of(a),t.pipe(m.h(Ee.Q.isCheetahSetContext)),t.pipe(m.h(Ee.Q.isCheetahResult))),V=n.pipe(_.w(G.fold((()=>I.of(G.none)),(e=>e.sessionService.session.view(G.some))))),L=new Set;b.rewrite&&S||L.add(ke.TG.StepName.rewrite);b.compose||L.add(ke.TG.StepName.initial);b.onboarding||(L.add(ke.TG.StepName.initial),L.add(ke.TG.StepName.rewrite),L.add(ke.TG.StepName.prompts),L.add(ke.TG.StepName.review));const j=l.pipe(T.QV(O.E),M.R(((e,t)=>{const i=e.filter(Le);return t&&Le(t)?[...i,t]:i}),[]),w.U(Ie.Z$),B.shareReplay({bufferSize:1,refCount:!0})),Q=y.aj([j,c,u]).pipe(w.U((([e,t,i])=>(0,r.zG)(e,G.filter((()=>t)),G.fold((()=>({})),(e=>({[ke.nF.initialPopupAnchor]:i?{reference:e,placement:"top",offset:8,boundaryAreaPadding:10}:void 0,[ke.nF.rewriteTooltipAnchor]:{reference:e,placement:"top",offset:8,boundaryAreaPadding:10}}))))))),$=n.pipe(_.w(G.fold((()=>I.of(!1)),(e=>e.viewModels.position.state.view((e=>"dragged"===e.kind&&e.dragging)))))),J=e=>{null==A||A.debug(`Completing step [${e}]`);p.get()[e].extension.completed||v({[e]:{completed:!0,lastSeen:Date.now()}})};return{userService:q,availabilityService:z,trackingService:U,textEditorService:{flush:()=>new F.y((t=>{const i=new h.w;return C.empty.get()?t.next(void 0):(C.flush(),(0,r.zG)(e.get(),G.fold((()=>t.next(void 0)),(e=>{i.add(e.messages.pipe(m.h((e=>e._tag===Re.J8.Type.submitOtAck)),N.L(500,I.of(null)),R.b((()=>t.next(void 0)))).subscribe())})))),()=>i.unsubscribe()})).pipe(f.q(1)).toPromise(),getText:x,insertText:E},feedbackService:{submitFeedback:e=>{k.feedbackFormSubmit(e.mood,e.source===ke.x2.Source.resultCard?"cheetah-card":e.source===ke.x2.Source.quickReplyInitialActions?"cheetah-quick-reply":(0,H.L0)(e.source),e.domain,e.message)}},uphookService:{onShowGetMorePrompts:e=>{e&&((0,Fe.n)(k,{placement:"grammarlyGoPrompts",upgradeHookName:"grammarlyGoPrompts",upgradeHookSlot:"grammarlyGo"}),(0,Te.Tb)().upgradeHooks.showUpgradeHook("grammarlyGoPrompts","grammarlyGo"))},onClickGetMorePrompts:e=>{e?((0,Fe.Q)(k,{placement:"grammarlyGoPrompts",upgradeHookName:"grammarlyGoPrompts",upgradeHookSlot:"grammarlyGo"}),(0,Te.Tb)().upgradeHooks.clickUpgradeHook("grammarlyGoPrompts","grammarlyGo"),(0,Pe.wW)("upHook","grammarlyGoPrompts")):self.open(o.Rd().appConfig.url.support)}},createOnboardingViewModel:()=>(0,Ue.kF)({upstreamOnboardingState:p,session:V,textStats:s,forceDisabledOnboardingSteps:L,assistantUIActions:P,externalElements:Q,hideAssistantOnboardingTooltips:$,promptsAllocated:z.promptsAllocated,client:"extension",trackingService:U,disposed:d,logger:Ne.C8.Logging.getLogger("OnboardingCompletionEffects"),completeOnboardingStep:J}),notifyAssistantUIAction:e=>P.next(e),dispose:()=>z.dispose()}}(this._checkingService,this._relevantCAPIEvents,this._user,this._assistantSession,this._textStats,this._sessionStartedUsageInfo,this._ideateButtonRefChange,L.h.combine(this._integration.canShowIdeateButtonPopups,this._gButtonPopupState.view("type").view((e=>!ze.has(e))),q.xD),L.h.combine(this._csPageState.view("cheetah").view((e=>(null==e?void 0:e.canShowInitialOnboarding)||!1)),this._initialOnboardingBlockedForSession,((e,t)=>e&&!t)),p.T(this._csPageState.view("isActiveTab").pipe(m.h((e=>!e))),this._disposed).pipe(f.q(1)),this._dapiSettings.view((e=>function(e){const t=ke.Zq.State.toClientState(Me(e.extension||""),"extension"),i=ke.Zq.State.toClientState(Me(e.editor||""),"editor"),n=ke.Zq.State.toClientState(Me(e.llamaMac||""),"llamaMac"),s=ke.Zq.State.toClientState(Me(e.llamaWindows||""),"llamaWin");return(0,r.zG)(ke.Zq.State.empty,ke.Zq.State.patch(t,"extension"),ke.Zq.State.patch(i,"editor"),ke.Zq.State.patch(n,"llamaMac"),ke.Zq.State.patch(s,"llamaWin"))}({extension:e["cheetah:onboardingState"],editor:e["cheetah:onboardingState:editor"],llamaMac:e["cheetah:onboardingState:llamaMac"],llamaWindows:e["cheetah:onboardingState:llamaWindows"]}))),(e=>{this._dapiActions.modifyCheetahOnboardingState((0,r.ls)(Me,(t=>(0,r.zG)(ke.Zq.State.toClientState(t,"extension"),(t=>({...t,...e})),(e=>ke.Zq.State.patch(e,"extension")(t)))),Be))}),this._featureFlags,this._integration.enableInlineRewrites,this._textChangeBuffer,(e=>this._integration.getText(e)),(e=>this._insertText(e)),this._gnar,this._log),this._isOnboardingPopupVisible=L.h.create(!1),this._entryPointsEnabled=L.h.create(!1),this.isAssistantOpened=this._assistantSession.view(G.isSome),this.isOnboardingPopupVisible=this._isOnboardingPopupVisible.view(),this.isCheetahAvailable=this._cheetahServices.availabilityService.availability.view((0,q.ff)(ke.a8.isUnavailable)),this._dapiActions.reloadPropsRateLimited(),this._subs.add(this._checkingService.pipe(m.h(G.isSome),_.w((e=>e.value.readyState)),m.h((e=>e===Re.kQ.ready)),v.P()).subscribe((()=>this._init()))),this._subs.add(this._listenToMonitoringEvents()),this._subs.add(this._setupIdeateTooltipStateObs()),this._subs.add(this._onboardingViewModel.pipe(_.w(G.fold((()=>b.E),(e=>e.uiActions))),m.h(Qe)).subscribe((()=>{this._cheetahCSActions.initialOnboardingShown()}))),this._subs.add(this._getOnboardingVMStepActive(ke.TG.StepName.initial).subscribe(S.wW(this._isOnboardingPopupVisible))),this._subs.add(this._gButtonPopupState.view("type").view((e=>He.has(e))).subscribe((e=>{e&&this._initialOnboardingBlockedForSession.set(!0)}))),this._subs.add(y.aj([this._gButtonDisabledReason,this._integration.entryPointsEnabled]).pipe(w.U((([e,t])=>t&&!function(e){const t=new Set([Ge.P.DATA_CONTROL_ACTIVE,Ge.P.OFFLINE,Ge.P.STAND_WITH_UKRAINE,Ge.P.USER_CLAIMED,Ge.P.USER_EDC_BLOCKED,Ge.P.SIGNED_OUT_GB]);return null!==e&&t.has(e)}(e)))).subscribe(S.wW(this._entryPointsEnabled))),this._registerDebugHelpers()}onRelevantCAPIEvent(e){this._relevantCAPIEvents.next(e)}closeAssistant(e){this._terminateAssistantSession(e)}_init(){this._subs.add(this._assistantFocused.subscribe((e=>this._log.debug("Assistant "+(e?"focused":"blurred"))))),this._subs.add(this._getInlineButtonUI().subscribe(S.wW(this._inlineButtonUI))),this._subs.add(this._getIdeateButtonUI().subscribe(S.wW(this._ideateButtonUI))),this._subs.add(this._getExpandedIdeateButtonUI().subscribe(S.wW(this._expandedIdeateButtonUI))),this._subs.add(this._getAssistantUI().subscribe(S.wW(this._assistantUI))),this._subs.add(this._getHighlightUI().subscribe(S.wW(this._highlightUI))),this._subs.add(this._getQuasiCaretUI().subscribe(S.wW(this._quasiCaretUI))),this._subs.add(this._getOnboardingUI().subscribe(S.wW(this._onboardingUI))),this._subs.add(this._updateSelectionRange().subscribe(S.wW(this._selectionRange))),this._subs.add(this._updateHighlightRects().subscribe(S.wW(this._highlightRects))),this._subs.add(this._updateQuasiCaretRect().subscribe(S.wW(this._quasiCaretRect))),this._subs.add(this._updateNativeCursor().subscribe()),this._subs.add(this._closeRewriteAssistantWhenUnfocused().subscribe()),this._subs.add(this._assistantSession.view(G.isSome).subscribe((e=>{e&&this._closeGrammarlyAssistant()}))),this._subs.add(this._createOnboardingViewModelWhenCheetahAvailable().subscribe()),this._subs.add(this._handleTryItOut().subscribe())}_handleTryItOut(){return this._onboardingViewModel.pipe(_.w(G.fold((()=>b.E),(e=>e.uiActions))),m.h(ke.lG.is(ke.lG.Kind.tryItOut)),R.b((()=>this._startNewAssistantSession(De(this._integration.quickReplyContext.get())&&this._featureFlags.quickReply?ke.z_.Mode.quickReply:ke.z_.Mode.ideation))))}_getOnboardingVMStepActive(e){return this._onboardingViewModel.pipe(_.w(G.fold((()=>I.of(!1)),(t=>t.activeStep.view((0,r.ls)(G.filter((e=>e.show)),G.map((e=>e.name)),z.FX(e)))))),C.x())}_listenToMonitoringEvents(){return xe.gz.getInstance().events.subscribe((e=>{this._log.info("received monitoring event",{ev:e}),(0,r.zG)(this._checkingService.get(),z.bw((t=>{ke._H.isError(e)?((0,Te.Tb)().cheetah.error(e,this._domain,t.sessionUuid),e.name!==ke._H.Error.Name.waitForContextTimeout&&e.name!==ke._H.Error.Name.waitForAckTimeout||"startSession"!==e.sourceEvent||(Date.now()-this._lastRestartAttemptTime.get()>d.LK(5)?(this._lastRestartAttemptTime.set(Date.now()),this._restartSession()):(0,Te.Tb)().cheetah.sessionRestartTimeout(e.name===ke._H.Error.Name.waitForAckTimeout?"ack":e.name===ke._H.Error.Name.waitForContextTimeout?"setContext":(0,H.L0)(e),this._domain,t.sessionUuid))):ke._H.isInfo(e)?(0,Te.Tb)().cheetah.info(e,this._domain,t.sessionUuid):(0,H.L0)(e)})))}))}_setupIdeateTooltipStateObs(){return this._cheetahServices.availabilityService.availability.pipe(x.O(null),E.G(),w.U((([e,t])=>e&&t&&ke.a8.isPassive(e)&&ke.a8.isActive(t)?G.some("Youâ€™ve got prompts!"):G.none)),_.w(G.fold((()=>I.of(G.none)),(e=>p.T(I.of(G.some(e)),I.of(G.none).pipe(k.g(3e3))))))).subscribe(S.wW(this._ideateButtonTooltipNotificationState))}_registerDebugHelpers(){!function(e){const t=self;t&&(t.cheetahDebug=t.cheetahDebug||{},Object.assign(t.cheetahDebug,e))}({services:this._cheetahServices,clearOnboarding:()=>this._dapiActions.modifyCheetahOnboardingState((()=>Be(ke.Zq.State.empty)))})}_createOnboardingViewModelWhenCheetahAvailable(){return this._cheetahServices.availabilityService.availability.view(ke.a8.isUsable).pipe(R.b((e=>this._onboardingViewModel.modify((t=>((0,r.zG)(t,z.bw((e=>e.dispose()))),e?G.some(this._cheetahServices.createOnboardingViewModel()):G.none))))))}_closeRewriteAssistantWhenUnfocused(){return this._assistantFocused.pipe(A.b(100),m.h((e=>!e&&(0,r.zG)(this._assistantSession.get(),G.fold(r.jv,(e=>e.sessionService.session.view((e=>"started"===e.kind&&ke.z_.Mode.isRewriteOrQuickRewrite(e.mode)&&G.isNone(e.inProgressResult)&&0===e.resultHistory.length)).get()))))),R.b((()=>this._terminateAssistantSession(ke.z_.EndReason.assistantBlurred))))}_onClickIdeateButton(e){G.isSome(this._assistantSession.get())?this._terminateAssistantSession(ke.z_.EndReason.closed):this._startNewAssistantSession(e)}_updateSelectionRange(){return y.aj([this._integration.selectionRange,this._assistantUI.pipe(m.h((e=>null===e)))]).pipe(w.U((([e,t])=>({selectionRange:e,assistantIsFocused:this._assistantFocused.get(),inlineButtonRecentlyPressed:this._inlineButtonRecentlyPressed.get(),ideateButtonRecentlyHovered:this._ideateButtonRecentlyHovered.get(),initialPopupOnboardingStepIsActive:this.isOnboardingPopupVisible.get(),assistantIsHidden:t}))),R.b((({inlineButtonRecentlyPressed:e,ideateButtonRecentlyHovered:t})=>{e&&this._inlineButtonRecentlyPressed.set(!1),t&&this._ideateButtonRecentlyHovered.set(!1)})),m.h((({selectionRange:e,assistantIsFocused:t,inlineButtonRecentlyPressed:i,ideateButtonRecentlyHovered:n,initialPopupOnboardingStepIsActive:s,assistantIsHidden:o})=>!!o||!i&&!n&&(!G.isNone(e)||!t&&!s))),w.U((({selectionRange:e})=>e)))}_updateHighlightRects(){return this._selectionRange.pipe(_.w(G.fold((()=>I.of([])),(e=>this._integration.getHighlightRects(e)))))}_updateQuasiCaretRect(){return this._selectionRange.pipe(_.w((e=>(0,r.zG)(e,G.filter(c.SV.isCollapsed),G.fold((()=>I.of([])),(e=>this._integration.getHighlightRects(e)))))),w.U((e=>(0,r.zG)(e,s.c2,G.map((e=>e[e.length-1]))))))}_updateNativeCursor(){return L.h.combine(this._quasiCaretRect,this._assistantSession.view(G.isSome),((e,t)=>(0,r.zG)(n.Y(G.option)({nativeUIHider:G.fromNullable(this._integration.createNativeUIHider),quasiCaretRect:e}),G.filter((()=>t)),z.ew((()=>{this._nativeCursorHider.modify((e=>((0,r.zG)(e,z.bw((e=>e.dispose()))),G.none)))})),z.bw((({nativeUIHider:e})=>{this._nativeCursorHider.modify((t=>((0,r.zG)(t,z.bw((e=>e.dispose()))),G.some(e()))))})))))}_terminateAssistantSession(e){this._assistantSession.modify(G.chain((t=>(t.dispose(e),G.none)))),e!==ke.z_.EndReason.closed&&e!==ke.z_.EndReason.textInserted&&e!==ke.z_.EndReason.assistantBlurred||this._integration.focusTextField()}_restartSession(){this._log.info("reconnecting checking service and restarting session"),(0,r.zG)(this._assistantSession.get(),z.bw((e=>{const t=e.sessionService.session.get().mode;e.dispose(ke.z_.EndReason.disposed),this._assistantSession.set(G.none),(0,r.zG)(this._checkingService.get(),z.bw((e=>{e.reconnect()}))),this._startNewAssistantSession(t)})))}_startNewAssistantSession(e){this._assistantFocused.set(!0);const t=ke.z_.Mode.isIdeation(e)?{mode:e}:ke.z_.Mode.isRewriteOrQuickRewrite(e)?{mode:e,selectedRange:(0,r.zG)(this._selectionRange.get(),G.getOrElseW((()=>({start:0,end:0}))))}:ke.z_.Mode.isQuickReply(e)?{mode:e,quickReplyContext:(0,r.zG)(this._integration.quickReplyContext.get(),G.fold((()=>ke.H3.empty),Ve))}:(0,H.vE)(e),i=new xe.ZP({startSessionOptions:t,textEditorService:this._cheetahServices.textEditorService,getCAPIClient:()=>(0,r.zG)(this._checkingService.get(),G.map((e=>({cheetahStartSession:t=>W.fj((()=>D.vM((()=>e.cheetahStartSession(t))))),cheetahAction:t=>W.fj((()=>D.vM((()=>e.cheetahAction(t))))),cheetahInterrupt:t=>W.fj((()=>D.vM((()=>e.cheetahInterrupt(t))))),cheetahSetVoice:t=>W.fj((()=>D.vM((()=>e.cheetahSetVoice(t))))),cheetahEndSession:()=>W.fj((()=>D.vM((()=>e.cheetahEndSession())))),setSessionOption:t=>W.fj((()=>D.vM((()=>e.setSessionOption(t)))))}))),G.toNullable),relevantCAPIEvents:this._relevantCAPIEvents.asObservable(),upstreamDialect:this._dapiSettings.view((({dialectWeak:e,dialectStrong:t})=>t?ke.LA.Dialect.Value.fromString(t):e?ke.LA.Dialect.Value.fromString(e):ke.LA.Dialect.Value.american)),onVoiceProfileSelectedDialectChange:e=>{this._dapiActions.changeStrongDialect(e)},trackingService:this._cheetahServices.trackingService}),n=X.TB.create(this._cheetahServices.userService,this._cheetahServices.availabilityService,this._cheetahServices.trackingService,this._cheetahServices.textEditorService,this._cheetahServices.uphookService,this._cheetahServices.feedbackService,i,{notify:e=>this._cheetahServices.notifyAssistantUIAction(e),onFocus:e=>this._assistantFocused.set(e),close:e=>this._terminateAssistantSession(e)},this._integration.assistantPlacement.pipe(P.oA)),s={sessionService:i,viewModels:n,dispose:e=>{i.dispose(e),n.dispose(),this._assistantFocused.set(!1)}};this._assistantSession.set(G.some(s))}_getInlineButtonUI(){return(0,r.zG)(n.Y(a.P)({inlineButtonInfo:this._integration.inlineButtonPlacement,selectionRange:this._selectionRange,selectionOngoing:p.T(this._integration.selectionRange.pipe(w.U((e=>(0,r.zG)(e,G.isSome)))),this._integration.selectionRange.pipe(A.b(100),U.h(!1))),assistantClosed:this._assistantSession.view(G.isNone),textMapIsEmpty:this._integration.textMapIsEmpty,quickReplyContext:this._integration.quickReplyContext,availability:this._cheetahServices.availabilityService.availability,entryPointsEnabled:this._entryPointsEnabled})).pipe(w.U((({inlineButtonInfo:e,selectionRange:t,selectionOngoing:i,assistantClosed:n,textMapIsEmpty:s,quickReplyContext:o,availability:a,entryPointsEnabled:c})=>(0,r.zG)(e,G.filter((()=>c)),G.filter((()=>n)),G.filter((()=>ke.a8.isUsable(a))),G.fold(r.gn,(e=>(0,r.zG)(t,G.fold(r.gn,(t=>s&&G.isSome(o)&&this._featureFlags.inlineQuickReply?l.createElement(he,{disabled:!1,referenceElement:e.referenceElement,placement:e.placement,offset:G.toNullable(e.offset),onClick:()=>{this._inlineButtonRecentlyPressed.set(!0),this._startNewAssistantSession(ke.z_.Mode.quickReply)}}):je(t)&&(this._featureFlags.inlineRewrite||this._featureFlags.magicRewrite)&&this._integration.enableInlineRewrites?l.createElement(pe,{disabled:i,referenceElement:e.referenceElement,placement:e.placement,offset:G.toNullable(e.offset),onOpenRewriteClick:this._featureFlags.inlineRewrite?()=>{this._inlineButtonRecentlyPressed.set(!0),this._startNewAssistantSession(ke.z_.Mode.rewrite)}:void 0,onMagicRewriteClick:this._featureFlags.magicRewrite?()=>{this._inlineButtonRecentlyPressed.set(!0),this._startNewAssistantSession(ke.z_.Mode.quickRewrite)}:void 0}):null)))))))))}_getAssistantUI(){return this._assistantSession.view(G.fold(r.gn,(e=>l.createElement(ce,{env:this._getEnv()},j.UI.mount((0,X.aK)(e.viewModels.assistant),(0,X.WY)(e.viewModels,{showDomainCheckbox:G.some(this._domain)}))))))}_getOnboardingUI(){return this._onboardingViewModel.view(G.fold(r.gn,(e=>l.createElement(ce,{env:this._getEnv()},j.UI.mount(Ue.gy,(0,Ue.Bx)(e))))))}_getHighlightUI(){return L.h.combine(this._highlightRects,this._assistantSession.view(G.isSome),this._assistantFocused,((e,t,i)=>t&&i?e.map(((e,t)=>l.createElement(J,{key:`cheetah-highlight-rect-${t}`,top:e.top,left:e.left,width:e.width,height:e.height}))):null))}_getQuasiCaretUI(){return L.h.combine(this._quasiCaretRect,this._assistantSession.view(G.isSome),((e,t)=>(0,r.zG)(e,G.filter((()=>t)),G.fold((()=>null),(e=>l.createElement(Se,{left:e.left,top:e.top,height:e.height,overflow:this._integration.allowCustomCaretOverflow}))))))}_getIdeateButtonUI(){return y.aj([this._inlineButtonUI,this._selectionRange,this._integration.quickReplyContext,this._cheetahServices.availabilityService.availability,this._entryPointsEnabled]).pipe(w.U((([e,t,i,n,s])=>(0,r.zG)(e,G.fromPredicate((e=>null===e)),G.filter((()=>s)),G.filter((()=>ke.a8.isUsable(n))),G.fold(r.gn,(()=>this._getIdeateButtonForSelectionRange(t,i)))))))}_getExpandedIdeateButtonUI(){return y.aj([this._selectionRange,this._integration.quickReplyContext,this._cheetahServices.availabilityService.availability,this._entryPointsEnabled]).pipe(w.U((([e,t,i,n])=>(0,r.zG)(i,G.fromPredicate((e=>ke.a8.isVisible(e))),G.filter((()=>n)),G.fold(r.gn,(()=>this._getIdeateButtonForSelectionRange(e,t)))))))}_getIdeateButtonForSelectionRange(e,t){return(0,r.zG)(e,G.filter((e=>je(e)&&this._featureFlags.rewrite)),G.fold((()=>De(t)&&this._featureFlags.quickReply?ke.z_.Mode.quickReply:this._featureFlags.compose?ke.z_.Mode.ideation:null),(()=>ke.z_.Mode.rewrite)),G.fromNullable,G.fold(r.gn,(e=>l.createElement(qe,{onMouseEnter:()=>this._ideateButtonRecentlyHovered.set(!0),onMouseLeave:()=>this._ideateButtonRecentlyHovered.set(!1),onClick:()=>this._onClickIdeateButton(e),mount:e=>this._ideateButtonRefChange.next(e),forceTooltipMessage:this._ideateButtonTooltipNotificationState.view(G.toUndefined)}))))}_insertText(e){""!==e?this._integration.insertText(e,this._selectionRange.get()):this._log.warn("insert() - attempting to insert empty response, skipping insert.")}dispose(){var e;this._disposed.next(null),this._terminateAssistantSession(ke.z_.EndReason.disposed),null===(e=G.toUndefined(this._onboardingViewModel.get()))||void 0===e||e.dispose(),this._cheetahServices.dispose(),this._subs.unsubscribe(),(0,r.zG)(this._nativeCursorHider.get(),z.bw((e=>e.dispose()))),this._integration.dispose()}}function De(e){return(0,r.zG)(e,G.exists((e=>Object.values(e).filter((e=>void 0!==e)).length>0)))}function Ve(e){var t,i,n,s,o,a,l,c,u,d,h,g,p,m,f,_,v;const b=e=>{var t;return null!==(t=null==e?void 0:e.reduce(((e,t)=>{var i;return t.email&&!e.has(t.email)&&e.set(t.email,{name:null!==(i=t.name)&&void 0!==i?i:"",email:t.email}),e}),new Map))&&void 0!==t?t:new Map},S=b(null===(n=null===(i=null===(t=e.parents)||void 0===t?void 0:t[0])||void 0===i?void 0:i.audience)||void 0===n?void 0:n.indirectRecipients),y=b(null===(a=null===(o=null===(s=e.parents)||void 0===s?void 0:s[0])||void 0===o?void 0:o.audience)||void 0===a?void 0:a.undisclosedRecipients),w=b(null===(d=null===(u=null===(c=null===(l=e.parents)||void 0===l?void 0:l[0])||void 0===c?void 0:c.audience)||void 0===u?void 0:u.recipients)||void 0===d?void 0:d.filter((({email:e})=>void 0!==e&&!S.has(e)&&!y.has(e)))),R=b(null===(h=e.audience)||void 0===h?void 0:h.indirectRecipients),I=b(null===(g=e.audience)||void 0===g?void 0:g.undisclosedRecipients),C=b(null===(m=null===(p=e.audience)||void 0===p?void 0:p.recipients)||void 0===m?void 0:m.filter((({email:e})=>void 0!==e&&!R.has(e)&&!I.has(e))));return{previousMessageInfo:(0,r.zG)(Ie.YM(null!==(f=e.parents)&&void 0!==f?f:[]),G.fold((()=>ke.H3.PreviousMessageInfo.empty),(e=>{var t;return{author:(0,r.zG)(Ie.YM(null!==(t=e.authors)&&void 0!==t?t:[]),G.fold((()=>ke.H3.Person.empty),(e=>{var t,i;return{name:null!==(t=e.name)&&void 0!==t?t:"",email:null!==(i=e.email)&&void 0!==i?i:""}}))),directRecipients:Array.from(w.values()),text:e.delta?(0,Ce.l)(e.delta,""):""}}))),title:null!==(_=e.title)&&void 0!==_?_:"",author:(0,r.zG)(Ie.YM(null!==(v=e.authors)&&void 0!==v?v:[]),G.fold((()=>ke.H3.Person.empty),(e=>{var t,i;return{name:null!==(t=e.name)&&void 0!==t?t:"",email:null!==(i=e.email)&&void 0!==i?i:""}}))),directRecipients:Array.from(C.values()),indirectRecipients:Array.from(R.values()),undisclosedRecipients:Array.from(I.values())}}function Le(e){return e.isConnected&&null!==e.offsetParent}function je(e){const t=e.end-e.start;return t>=10&&t<5e3}function Qe(e){return(0,q.W9)(ke.lG.is(ke.lG.Kind.mount),(e=>e.step===ke.TG.StepName.initial))(e)}},30732:(e,t,i)=>{var n;i.d(t,{P:()=>n}),function(e){e.OFFLINE="offline",e.POPUP_VISIBLE="popup_visible",e.POPUP_VISIBLE_ALLOW_HOVER="popup_visible_allow_hover",e.DATA_CONTROL_ACTIVE="data_control_active",e.USER_EDC_BLOCKED="user_edc_blocked",e.ASSISTANT_VISIBLE="assistant_visible",e.USER_CLAIMED="user_claimed",e.SIGNED_OUT_GB="signed_out_gb",e.STAND_WITH_UKRAINE="stand_with_ukraine"}(n||(n={}))},16105:(e,t,i)=>{i.d(t,{k:()=>s,q:()=>n});var n,s,o=i(19744),a=i(90361);!function(e){let t;function i(e){return e._tag===t.ins}function n(e){return e._tag===t.del}!function(e){e.ins="ins",e.del="del"}(t=e.Type||(e.Type={})),e.isIns=i,e.ins=function(e,i){return{_tag:t.ins,pos:e,text:i}},e.isDel=n,e.del=function(e,i){return{_tag:t.del,pos:e,length:i}},e.applyChanges=function(e,t){return t.reduce(((e,t)=>i(t)?e.slice(0,t.pos)+t.text+e.slice(t.pos):n(t)?e.slice(0,t.pos)+e.slice(t.pos+t.length):(0,a.vE)(t)),e)},e.getTransformOffset=function(e){return i(e)?e.text.length:n(e)?-e.length:(0,a.vE)(e)},e.getRange=function(e){return{start:e.pos,end:e.pos+(i(e)?e.text.length:e.length)}}}(n||(n={})),function(e){e.fromDiff=function(e,t,i){const s=o(e,t,i);let a=0;const r=[];for(const e of s)e[0]===o.EQUAL?a+=e[1].length:e[0]===o.INSERT?(r.push(n.ins(a,e[1])),a+=e[1].length):r.push(n.del(a,e[1].length));return r}}(s||(s={}))},86620:(e,t,i)=>{i.d(t,{C:()=>c,U:()=>n});var n,s=i(27378),o=i(29511),a=i(33678),r=i(88056),l=i(95574);!function(e){let t;!function(e){e.isAppleSystem="isAppleSystem"}(t=e.SidebarFlag||(e.SidebarFlag={})),e.Flag={...t,...a.a.Flag},e.Context=s.createContext(r.Y.invariantContent("Environment"))}(n||(n={}));class c{constructor(e=(0,o.O)()){this._flags=new Set,this.actions={openUrl:e=>l.vM((()=>{document.location.href=e.toString()})),openPopup:e=>l.vM((()=>{const t=self.open(e.toString(),void 0,"noreferrer");t&&(t.opener=null)}))},e.config.systemInfo.os.isMac&&this._flags.add(n.Flag.isAppleSystem),this._flags.add(n.Flag.supportsSVGDominantBaseline),this._flags.add(n.Flag.onlyTrustedEvents)}has(e){return this._flags.has(e)}}},92132:(e,t,i)=>{i.d(t,{Q:()=>l});var n=i(27378),s=i(15073),o=i(60797),a=i(19751),r=i(5114);const l=({children:e,remSize:t,setter:i})=>(c+=1,n.useEffect((()=>{const e=t.subscribe((e=>{u.next(r.some(e)),i(r.some(e))}));return()=>{e.unsubscribe(),c-=1,0===c&&(u.next(r.none),i(r.none))}}),[t]),n.createElement(s.u.Context.Provider,{value:u.pipe(o.oA)},e));let c=0;const u=new a.BehaviorSubject(r.none)},55073:(e,t,i)=>{if(i.d(t,{AQ:()=>h,SO:()=>u,l:()=>g,n:()=>d}),1307!=i.j)var n=i(57050);if(1307!=i.j)var s=i(16105);if(1307!=i.j)var o=i(90361);if(1307!=i.j)var a=i(5114);if(1307!=i.j)var r=i(25938);if(1307!=i.j)var l=i(8709);var c=i(36991);function u(e,t){return(0,n.zG)(function(e){return 2===e.length&&e[0].pos===e[1].pos?e[0]._tag===s.q.Type.del&&e[1]._tag===s.q.Type.ins?a.some([e[0],e[1]]):e[0]._tag===s.q.Type.ins&&e[1]._tag===s.q.Type.del?a.some([e[1],e[0]]):a.none:a.none}(e),a.fold((()=>e),(e=>{const i=t.slice(e[0].pos,e[0].pos+e[0].length);return e[1].text===i?[]:e[1].text.startsWith(i)?[s.q.ins(e[0].pos+i.length,e[1].text.slice(i.length))]:i.startsWith(e[1].text)?[s.q.del(e[1].pos+e[1].text.length,i.length-e[1].text.length)]:e})))}function d(e){return e.reduce(((e,t)=>{switch(t._tag){case s.q.Type.ins:return e.compose(r.RI.ins(t.pos,t.text));case s.q.Type.del:return e.compose(r.RI.del(t.pos,t.length));default:return(0,o.vE)(t)}}),r.RI.delta(new l.i)).delta}function h(e){return e.reduce(((e,t)=>{if(c.s.isInsert(t)&&"string"==typeof t.insert){const i=t.insert.replace(/\r\n/g,"\n").replace(/\r/g,"\n");return e.insert(i,t.attributes)}return e.push(t)}),new l.i)}function g(e,t){return e.reduce(((e,t)=>(c.s.isInsertString(t)?(e.text=`${e.text.substring(0,e.index)}${t.insert}${e.text.substring(e.index)}`,e.index+=t.insert.length):c.s.isDelete(t)?e.text=`${e.text.substring(0,e.index)}${e.text.substring(e.index+t.delete)}`:c.s.isRetain(t)?e.index+=t.retain:function(e){var t;return c.s.isInsertEmbed(e)&&!0===(null===(t=e.insert)||void 0===t?void 0:t.linebreak)}(t)&&(e.text=`${e.text.substring(0,e.index)}\n${e.text.substring(e.index)}`,e.index+=1),e)),{text:t,index:0}).text}},58541:e=>{e.exports={highlightRect:"QY8r6"}},74229:e=>{e.exports={ideateButton:"uvaxX",ideateButtonIcon:"FxRsU",spin:"Dl_cd"}},73734:e=>{e.exports={entryButton:"NpkKC",entryButtonItem:"qkhc6",rewriteIcon:"KF9IT",openIcon:"wnIMZ",spin:"VCOho"}},62810:e=>{e.exports={replyButton:"d5jYx",icon:"wJ_DO",spin:"N20SX"}},60688:e=>{e.exports={quasiCaret:"W8Ec1",icon:"wlLHd"}}}]);